## CND

- 什么是CDN: 全称是 Content Delivery Network，即内容分发网络。
- 18电商节、双十一购物狂欢节，到底是什么在支撑数以万计的秒杀活动？这就不得不提一直隐姓埋名的 CDN 了，当网站访问人数过多时网站不堪重负。

### 限制访问网站速度的因素

- 第一公里: 这里指万维网流量向用户传送的第一个出口，是网站服务器接入互连网的链路所提供的带宽。这个带宽决定了一个网站能够为用户提供的访问速度和并发访问量。一个网站其服务的用户越多，对其出口带宽的要求也就越大。当用户的请求数量量超过网络的出口带宽时，就会在出口形成堵塞。
- 长途传输骨干: 从网站服务器到用户之间要经过网站所在的IDC、骨干网、用户所在城域网、用户所在接入网，物理距离十分遥远。因此会有延时、拥塞等问题。
- 对等互联关口: 这里的“对等互联”是指不同基础运营商之间的互连互通，一般两个运营商之间只有两三个互联互通点，可以想象在这两三个点上会产生多大的流量。因此这里往往是互联网传输中的堵塞点。
- 最后一公里: 即用户接入带宽，现在主要用光纤上网，所以已经得到了很大的解决。

### 解决方案CDN

- 用户通过浏览器访问服务器

![](./img/用户访问浏览器.jpg)

1. 用户在自己的浏览器中输入要访问的网站域名。


2. 浏览器向 **本地DNS服务器** 请求对该域名的解析。
3. 本地DNS服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求。
4. 本地DNS服务器中如果没有关于这个域名的解析结果的缓存，则以递归方式向整个DNS系统请求解析，获得应答后将结果反馈给浏览器。
5. 浏览器得到域名解析结果，就是该域名相应的服务设备的 **IP地址** 。
6. 浏览器向服务器请求内容。
7. 服务器将用户请求内容传送给浏览器。

- 在网站和用户之间加入 CDN 以后，用户不会有任何与原来不同的感觉。最简单的 CDN 网络有一个 DNS 服务器和几台缓存服务器就可以运行了。一个典型的 CDN 用户访问**调度流程**如图所示:

![](./img/CDN.jpg)

1. 当用户点击网站页面上的内容URL，经过本地DNS系统解析，DNS 系统会最终将域名的解析权交给 [CNAME](https://en.wikipedia.org/wiki/CNAME_record) 指向的 **CDN 专用 DNS 服务器**。
2. CDN 的 DNS 服务器将 CDN 的全局负载均衡设备 IP 地址返回用户。
3. 用户向 CDN 的全局负载均衡设备发起内容 URL 访问请求。
4. CDN 全局负载均衡设备根据用户 IP 地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。
5. 基于以下这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的IP地址：
   - 根据用户 IP 地址，判断哪一台服务器距用户最近；
   - 根据用户所请求的 URL 中携带的内容名称，判断哪一台服务器上有用户所需内容；
   - 查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。
6. 全局负载均衡设备把**服务器的 IP 地址**返回给用户。
7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。

**DNS 服务器根据用户 IP 地址，将域名解析成相应节点的缓存服务器IP地址，实现用户就近访问。**使用 CDN 服务的网站，只需将其域名解析权交给 CDN 的全局负载均衡（GSLB）设备，将需要分发的内容注入 CDN，就可以实现内容加速了。

### 详解链接

<https://segmentfault.com/a/1190000010631404#articleHeader4>